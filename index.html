<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <style>
body { font-family: sans-serif; margin:0; }
#gantt { position: relative; width: 100%; height: 400px; border: 1px solid #ccc; overflow-x: auto; }
.gantt-bar {
    position: absolute;
    height: 20px;
    border-radius: 4px;
    color: white;
    display: flex;
    align-items: center;
    padding-left: 4px;
    font-size: 12px;
}
.gantt-tick {
    position: absolute;
    top: 0;
    height: 10px;
    border-left: 1px solid #999;
    font-size: 12px;
    text-align: left;
    transform: translateX(-1px);
}
.gantt-tick-label {
    position: absolute;
    top: 10px;
    font-size: 12px;
}
</style>
    <script src="https://docs.getgrist.com/grist-plugin-api.js"></script>
  </head>
  <body>
    <div id="gantt"></div>
    <script>
grist.ready();
grist.onRecords(records => {
    console.log("Records reçus:", records);
    renderGantt(records);
});

function renderGantt(records) {
    const container = document.getElementById("gantt");
    container.innerHTML = "";

    if (!records.length) return;

    const startYears = records.map(r => r.hasStartYear);
    const endYears = records.map(r => r.hasEndYear || r.hasStartYear);

    const minYear = Math.floor(Math.min(...startYears) / 10) * 10;
    const maxYear = Math.ceil(Math.max(...endYears) / 10) * 10;

    const SCALE = 10; // pixels par an
    const widthPx = (maxYear - minYear) * SCALE + 100;
    container.style.width = widthPx + "px";

    // --- Axe décennal ---
    for (let year = minYear; year <= maxYear; year += 10) {
        const tick = document.createElement("div");
        tick.className = "gantt-tick";
        tick.style.left = ((year - minYear) * SCALE) + "px";

        const label = document.createElement("div");
        label.className = "gantt-tick-label";
        label.style.left = ((year - minYear) * SCALE - 10) + "px";
        label.textContent = year;

        container.appendChild(tick);
        container.appendChild(label);
    }

    // --- Barres ---
    let yOffset = 40;
    records.forEach(r => {
        const start = r.hasStartYear;
        const end = r.hasEndYear || r.hasStartYear;
        const color = r.hasColor || "#777";
        const bar = document.createElement("div");
        bar.className = "gantt-bar";
        bar.style.left = ((start - minYear) * SCALE) + "px";
        bar.style.top = yOffset + "px";
        bar.style.width = ((end - start) * SCALE) + "px";
        bar.style.background = color;
        bar.textContent = `${start}–${end}`;
        container.appendChild(bar);
        yOffset += 30;
    });
}
</script>
  </body>
</html>
